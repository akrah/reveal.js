<!doctype html>
<!-- **************************************************************************
 * HTML Template used by Pandoc to generate Reveal.js slides
 * from a Markdown file.
 *
 * In order to use it, Define the parameter 'template: akrah' in the
 * config file config.yml of your project.
 *
 * MIT licensed.
 *
 * Copyright (C) 2018 Adrien Krähenbühl
 ************************************************************************** -->
<html lang="fr">
<head>
    <title>W31 - Programmation Web<br>côté serveur</title>
    <meta charset="utf-8">
    <meta name="description" content="W31 - Programmation Web<br>côté serveur">
    <meta name="author" content="Adrien Krähenbühl">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/fonts/palatino/palatino.css">
    <link rel="stylesheet" href="dist/theme/fonts/source-sans-pro/source-sans-pro.css">
    <link rel="stylesheet" href="dist/theme/fonts/league-gothic/league-gothic.css">
    <link rel="stylesheet" href="dist/theme/iutrs.css">
    <style>
    .reveal .first-slide .slide-background-content {
        background-image: url(img/firstPage.jpg);
        opacity: 0.4;
    }
    .reveal .slides .first-slide h4 {
        font-family: monospace;
        font-style: normal;
        font-size: 1.3em;
    }
    .reveal {
        font-family: "Palatino";
    }
    .reveal h2,
    .reveal h3,
    .reveal h4,
    .reveal h5,
    .reveal h6 {
        font-family: "Palatino";
    }
    .reveal .slides h1 {
        font-family: "League-Gothic";
    }
    .reveal .slides h2:not(:only-child) {
        font-family: "League-Gothic";
    }
    </style>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="plugin/highlight/tomorrow-night-eighties.css">
        </head>
<body>


<div class="reveal">
<div class="slides">

<section class="slide level2 first-slide">
<h1>W31 - Programmation Web<br>côté serveur</h1>
<h4>&lt;?= “2. PDO et POO” ?&gt;</h4>
<address>
    <a href="http://adrien.krahenbuhl.fr">Adrien Krähenbühl</a>
    
<time>25 septembre 2020</time>
    <a href="http://iutrs.unistra.fr/formation/dut/dut-informatique">IUT Robert Schuman</a>
    
</address>
</section>

<!--===========================================================================
                              <Begin Markdown>                              -->

<section id="avant-de-commencer" class="slide level2">
<h2>Avant de commencer</h2>
<div class="columns">
<div class="column-5">
<dl>
<dt>Version de PHP</dt>
<dd>Ce cours se base entièrement sur <strong>PHP 7</strong>.<br> =&gt; PHP 8 sortira le 26 Novembre.
</dd>
</dl>
</div><div class="images centerh column-3">
<p><img data-src="img/php7.png" class="width-40" /></p>
</div>
</div>
<div class="fragment">
<dl>
<dt>Rappel doc &amp; stackoverflow-like</dt>
<dd><span class="math inline">\(\rightarrow\)</span> ne recopiez pas bêtement<br />
<span class="math inline">\(\rightarrow\)</span> la seule aide fiable est la doc officielle sur <a href="http://php.net">php.net</a>
</dd>
</dl>
</div>
<div class="columns fragment">
<div class="column-5">
<dl>
<dt>Premier QCM noté</dt>
<dd><span class="math inline">\(\rightarrow\)</span> sur Moodle<br />
<span class="math inline">\(\rightarrow\)</span> au début du prochain TD
</dd>
</dl>
</div><div class="images centerh column-3">
<p><img data-src="img/qcm.svg" class="width-25" /></p>
</div>
</div>
</section>
<section id="ce-que-lon-a-vu" class="slide level2">
<h2>Ce que l’on a vu</h2>
<ol type="1">
<li><strong>Concept client-serveur</strong>
<ul>
<li>mécanisme de requête/réponse via le protocole HTTP</li>
</ul></li>
<li><strong>Intro PHP</strong>
<ul>
<li>intégration intrinsèque dans du code HTML</li>
<li>syntaxe : variables, tableaux, boucles et conditions</li>
<li>inclusion de fichiers</li>
</ul></li>
<li><strong>Échange de données client <span class="math inline">\(\leftrightarrow\)</span> serveur</strong>
<ul>
<li>méthodes GET (<code>$_GET</code>) et POST (<code>$_POST</code>)</li>
<li>vérification <strong>et</strong> protection des données transmises par le client : <code>isset</code>, <code>htmlentities</code></li>
</ul></li>
<li><strong>Persistance des données</strong>
<ul>
<li>cookies (<code>$_COOKIE</code>) <span class="math inline">\(\rightarrow\)</span> données stockées <strong>chez le client</strong></li>
<li>sessions (<code>$_SESSSION</code>) <span class="math inline">\(\rightarrow\)</span> données stockées <strong>sur le serveur</strong></li>
</ul></li>
</ol>
</section>
<section id="au-programme-aujourdhui" class="slide level2">
<h2>Au programme aujourd’hui</h2>
<ol type="1">
<li><strong>Fonctions</strong> : syntaxe, typage</li>
<li><strong>POO</strong> : classes et objets, mot-clé <code>this</code></li>
<li><strong>Exceptions</strong> : <code>try</code> / <code>catch</code> / <code>throw</code></li>
<li><strong>SQLite &amp; PDO</strong> : requêtes simples et préparées</li>
<li><strong>MVC</strong> : spécificités d’une application client-serveur</li>
<li><strong>Héritage</strong> (bonus) : interfaces et classes abstraites</li>
</ol>
<div class="fragment centerh">
<p><img data-src="img/eddStark.gif" class="width-100" /></p>
</div>
</section>
<section id="et-jusquaux-vacances-doctobre" class="slide level2">
<h2>Et jusqu’aux vacances d’octobre</h2>
<p>Deux cycles vont s’enchaîner :</p>
<dl>
<dt>1 TD + 3 TPs</dt>
<dd>Gestionnaire de comptes utilisateurs en POO avec SQLite et PDO.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>1 CM + 1 TD + 1 TP</dt>
<dd><ul>
<li>MVC avec le framework <a href="https://laravel.com">Laravel</a></li>
<li>Début du mini-projet</li>
<li>Second QCM au début du TD</li>
</ul>
</dd>
</dl>
</div>
<p><br />
</p>
<div class="fragment box">
<p><em>Attention, chaque TP est basé sur le précédent,<br />
ne prenez pas de retard !</em></p>
</div>
</section>
<section id="les-fonctions" class="slide level2 chapter">
<h2>Les fonctions</h2>
</section>
<section id="syntaxe" class="slide level2">
<h2>Syntaxe</h2>
<div class="columns centerh">
<div>
<pre class="php contenteditable"><code>function doIt( bool $arg, int $i ) : void
{
    // Traitements...

}</code></pre>
<pre class="php contenteditable"><code>doIt( true, 1 );</code></pre>
<p><em>Sans retour</em></p>
</div><div>
<pre class="php contenteditable"><code>function doItAgain() : string
{
    // Traitements...
    return $result;
}</code></pre>
<pre class="php contenteditable"><code>$myString = doItAgain();</code></pre>
<p><em>Avec retour</em></p>
</div>
</div>
<p><br></p>
<div class="fragment">
<ul>
<li>Du <strong>typage statique</strong> (enfin depuis la v. 7 !) dans PHP pour :
<ul>
<li>les arguments,</li>
<li>la valeur de retour d’une fonction.</li>
</ul></li>
<li>Le typage n’est pas obligatoire mais <strong>fortement recommandé</strong>.</li>
<li>Les principaux types : <code>array</code>, <code>bool</code>, <code>float</code>, <code>int</code>, <code>string</code> et <code>object</code>.</li>
</ul>
</div>
</section>
<section id="transtypage-cast-coercitif" class="slide level2">
<h2>Transtypage (cast) coercitif</h2>
<p>En PHP, <strong>typer</strong> signifie <strong>transtyper</strong> si le type utilisé n’est pas le bon.</p>
<br>
<div class="columns centerh">
<div>
<pre class="php contenteditable"><code>function add( float $a, float $b ) : float {
    return $a + $b;
}
echo add( 3, 4 );      // Affiche 7
echo add( 3, 4.99 );   // Affiche 7.99
echo add( 3, &quot;4.3&quot; );  // Affiche 7.3
echo add( 3, &quot;plop&quot; ); // Error</code></pre>
<p><em>Transtypage des arguments</em></p>
</div><div class="fragment">
<pre class="php contenteditable"><code>function add( float $a, float $b ) : int {
    return $a + $b;
}
echo add( 3, 4 );      // Affiche 7
echo add( 3, 4.99 );   // Affiche 7
echo add( 3, &quot;4.3&quot; );  // Affiche 7
echo add( 3, &quot;plop&quot; ); // Error</code></pre>
<p><em>Transtypage de la valeur de retour</em></p>
</div>
</div>
<p><br></p>
<div class="fragment box">
<p><strong>Note</strong> : Il est possible d’imposer un <strong>typage strict</strong> en déclarant cette instruction <strong>en début de fichier</strong> :</p>
<pre class="php contenteditable"><code>&lt;?php
        declare(strict_types=1);
        ...</code></pre>
</div>
<div class="fragment centerh">
<p><em><span class="math inline">\(\rightarrow\)</span> <a href="https://thevaluable.dev/php-7-type-hinting-pitfalls/">Un lien intéressant qui triture le typage en PHP 7</a></em></p>
</div>
</section>
<section id="classes-et-objets" class="slide level2 chapter">
<h2>Classes et objets</h2>
</section>
<section id="syntaxe-1" class="slide level2">
<h2>Syntaxe</h2>
<div class="columns centerh">
<div>
<pre class="php contenteditable"><code>class Truc
{
    public $membre;
    public function methode() { ... }
}</code></pre>
<p><em>Définition de la classe <code>Truc</code></em></p>
</div><div>
<pre class="php contenteditable"><code>$obj = new Truc();

echo var_dump($obj);
// Affiche :
//    object(Truc)#1 (1) { [&quot;membre&quot;]=&gt; NULL }</code></pre>
<p><em>Instanciation d’un objet de type <code>Truc</code></em></p>
</div>
</div>
<p><br></p>
<h3 id="définition-classe-vs.-objet-rappels" class="fragment">Définition classe vs. objet (rappels)</h3>
<div class="fragment">
<dl>
<dt>Une <strong>classe</strong></dt>
<dd>C’est la <strong>description</strong> d’un objet comme ensemble d’<strong>attributs</strong> et de <strong>méthodes</strong>. Une classe n’a pas d’existence propre.
</dd>
<dt>Un <strong>objet</strong></dt>
<dd>C’est une <strong>instance</strong> d’une classe donnée. Il <strong>existe</strong> de sa création<br />
avec <code>new</code> jusqu’à sa destruction.
</dd>
</dl>
</div>
</section>
<section id="les-attributs" class="slide level2">
<h2>Les attributs</h2>
<div class="columns">
<pre class="php contenteditable centerh"><code>class MaClasse {
    public string $attribut1;
    public int $attribut2 = 31;
}</code></pre><pre class="php contenteditable centerh"><code>// Création d&#39;un objet
// de type MaClasse

$obj = new MaClasse();</code></pre><pre class="php contenteditable centerh"><code>// Accès aux attributs publics
echo $obj-&gt;attribut2;
// Modification d&#39;un attribut
$obj-&gt;attribut1 = &quot;W31&quot;;</code></pre>
</div>
<dl>
<dt>Définition</dt>
<dd>Aussi appelé “propriété”, c’est une <strong>variable interne</strong> d’une classe.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>Un attribut :</dt>
<dd><ul>
<li>peut (<strong>doit !</strong>) être spécifié avec une <a href="https://www.php.net/manual/fr/language.oop5.visibility.php"><strong>visibilité</strong></a></li>
<li>peut (<strong>doit !</strong>) être spécifié avec un <a href="https://www.php.net/manual/en/language.types.php"><strong>type</strong></a></li>
<li>est accessible depuis un objet avec le symbole <strong><code>-&gt;</code></strong> suivi de son nom <strong>sans le symbole <code>$</code></strong></li>
</ul>
</dd>
</dl>
</div>
<div class="fragment box">
<p><em><strong>Attention</strong>, le <a href="https://wiki.php.net/rfc/typed_properties_v2">typage des attributs</a> ne fonctionne qu’avec PHP &gt;= 7.4 !<br />
(donc pas sur les serveurs de l’IUT qui ont PHP 7.3)</em></p>
</div>
</section>
<section id="les-méthodes" class="slide level2">
<h2>Les méthodes</h2>
<div class="columns centerh">
<div>
<pre class="php contenteditable centerh"><code>class MaClasse
{
    private int $_val;
    public function __construct( int $valeur )   { $this-&gt;_val = $valeur; }
    public function __destruct()                 {}
    public function getVal() : int               { return $this-&gt;_val; }
    public function setVal( int $valeur ) : void { $this-&gt;_val = $valeur; }
}</code></pre>
</div><div>
<pre class="php contenteditable centerh"><code>// Création d&#39;un objet
$obj = new MaClasse(5);

echo $obj-&gt;getVal();
// Affiche &quot;5&quot;
$obj-&gt;setVal( 31 );
echo $obj-&gt;getVal();
// Affiche &quot;31&quot;</code></pre>
</div>
</div>
<dl>
<dt>Définition</dt>
<dd>Une méthode est une fonction interne à une classe. Elle est appelée sur un objet pour connaître son état ou le modifier.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>Le mot-clé <a href="https://www.php.net/manual/fr/language.oop5.basic.php"><code>$this</code></a> :</dt>
<dd><ul>
<li>représente n’importe quel objet <strong>instance</strong> de cette classe.</li>
<li>est <strong>obligatoire</strong> en PHP (à l’inverse de Java par exemple)</li>
</ul>
</dd>
</dl>
</div>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> L’implémentation d’une méthode définit un comportement <strong>pour tous les objets <code>$this</code></strong> sur lesquels elle sera appelée.</p>
</div>
</section>
<section id="exceptions" class="slide level2 chapter">
<h2>Exceptions</h2>
</section>
<section id="syntaxe-2" class="slide level2">
<h2>Syntaxe</h2>
<div class="columns centerh">
<div>
<pre class="php contenteditable centerh"><code>function diviser( int $num, int $denom ) : float
{
    if ( $denom == 0 ) {
        throw new Exception(&quot;Division par zéro&quot;);
    }
    return $num / $denom;
}</code></pre>
<p><em>Déclenchement d’une exception.</em></p>
</div><div>
<pre class="php contenteditable centerh"><code>try {
    echo diviser(4,5);
    echo diviser(4,0);
}
catch ( Exception $e ) {
    echo &quot;Erreur : &quot; . $e-&gt;getMessage();
}
</code></pre>
<p><em>Capture d’une exception.</em></p>
</div>
</div>
<dl>
<dt>Définition</dt>
<dd>Les exceptions sont un mécanisme de <strong>gestion des comportements indésirables</strong> qui <strong>interrompt l’exécution</strong> d’une instruction.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>Une exception :</dt>
<dd><ul>
<li><strong>se lance</strong> avec l’instruction <strong><code>throw</code></strong></li>
<li><strong>se capture</strong> avec un bloc <strong><code>try</code></strong></li>
<li><strong>se traite</strong> avec un bloc <strong><code>catch</code></strong></li>
<li>doit être de type <code>Exception</code> ou d’un sous-type</li>
</ul>
</dd>
</dl>
</div>
</section>
<section id="sqlite-pdo" class="slide level2 chapter">
<h2>SQlite &amp; PDO</h2>
</section>
<section id="présentation" class="slide level2">
<h2>Présentation</h2>
<div class="images centerh">
<p><img data-src="img/pdo.svg" /></p>
</div>
<p>En PHP, il est nécessaire d’utiliser une extension pour manipuler une base de données. La référence en la matière est l’extension <strong>PDO</strong>.</p>
<p>PDO est une <strong>interface d’abstraction</strong>, c’est-à-dire qu’elle permet d’écrire du code <strong>indépendamment du SGBD utilisé</strong>.</p>
</section>
<section id="création-dun-objet-pdo" class="slide level2">
<h2>Création d’un objet PDO</h2>
<div class="columns">
<div class="centerh">
<pre class="php contenteditable centerh"><code>$SQL_DSN = &#39;sqlite:/home/.../bdd.db&#39;;



try {
    $pdo = new PDO($SQL_DSN);
}
catch( PDOException $e ) {
    echo &#39;Erreur : &#39;.$e-&gt;getMessage();
    exit;
}</code></pre>
<p><em>SQLite</em></p>
</div><div class="centerh">
<pre class="php contenteditable centerh"><code>$SQL_DSN   = &#39;mysql:host=bdd.site.fr;dbname=w31&#39;;
$SQL_LOGIN = &#39;login&#39;;
$SQL_PASS  = &#39;password&#39;;

try {
    $pdo = new PDO($SQL_DSN, $SQL_LOGIN, $SQL_PASS);
}
catch( PDOException $e ) {
    echo &#39;Erreur : &#39;.$e-&gt;getMessage();
    exit;
}</code></pre>
<p><em>MySQL/MariaDB</em></p>
</div>
</div>
<p>La création d’un objet PDO pour SQLite nécessite <strong>un seul argument</strong>, le <a href="https://fr.wikipedia.org/wiki/Data_Source_Name"><strong>DSN</strong></a>, contenant le type de SGBD et le chemin absolu du fichier de BDD.<br> <br></p>
<div class="box">
<p><em><strong>Attention</strong> : Une <code>PDOException</code> est déclenchée si la connexion échoue,<br />
il faut toujours la “try-catcher” !</em></p>
</div>
</section>
<section id="requêtes-simples" class="slide level2">
<h2>Requêtes simples</h2>
<dl>
<dt><a href="https://www.php.net/manual/en/pdo.query.php"><code>PDO::query( string $statement ) : PDOStatement</code></a></dt>
<dd><ul>
<li>Pour <strong>interroger</strong> la BDD (<code>SELECT</code>).</li>
<li>Retourne un objet <code>PDOStatement</code> contenant les données trouvées.</li>
<li>Retourne <code>false</code> en cas d’erreur.</li>
</ul>
</dd>
</dl>
<pre class="php contenteditable centerh"><code>$request = $pdo-&gt;query( &quot;SELECT * FROM Students&quot; );</code></pre>
<dl>
<dt><a href="https://www.php.net/manual/en/pdo.exec.php"><code>PDO::exec( string $statement ) : int</code></a></dt>
<dd><ul>
<li>Pour <strong>modifier</strong> la BDD (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, etc.)</li>
<li>Retourne le nombre de lignes modifiées.</li>
</ul>
</dd>
</dl>
<pre class="php contenteditable centerh"><code>$nbInsertions = $pdo-&gt;exec( &quot;INSERT INTO Students(name) VALUES(&#39;Josh&#39;)&quot; );
    $nbUpates = $pdo-&gt;exec( &quot;UPDATE Students SET name=&#39;John&#39; WHERE name=&#39;Josh&#39;&quot; );
 $nbDeletions = $pdo-&gt;exec( &quot;DELETE FROM Students WHERE name=&#39;John&#39;&quot; );</code></pre>
</section>
<section id="parcours-dun-pdostatement" class="slide level2">
<h2>Parcours d’un “PDOStatement”</h2>
<div class="centerh">
<pre class="php contenteditable"><code>$request = $pdo-&gt;query( &quot;SELECT name FROM Students&quot; );</code></pre>
<p><em><code>$request</code> est un objet de la classe <code>PDOStatement</code></em>.</p>
</div>
<div class="columns centerh">
<div>
<pre class="php contenteditable"><code>foreach( $request as $row ) {
    echo &#39;Nom : &#39; . $row[&#39;name&#39;];
}</code></pre>
<p><em>Parcours avec <code>foreach</code></em>.</p>
</div><div>
<pre class="php contenteditable"><code>while ( $row = $request-&gt;fetch() ) {
    echo &#39;Nom : &#39; . $row[&#39;name&#39;];
}</code></pre>
<p><em>Parcours avec <code>while</code> et <code>fetch</code></em>.</p>
</div>
</div>
<p>En complément de <code>foreach</code>, la méthode <code>fetch()</code> de la classe <code>PDOStatement</code> permet de parcourir les données obtenues :</p>
<dl>
<dt><a href="https://www.php.net/manual/fr/pdostatement.fetch.php"><code>PDOStatement::fetch() : mixed</code></a></dt>
<dd><ul>
<li>Retourne la <strong>prochaine</strong> ligne de données d’un <code>PDOStatement</code>.</li>
<li>Retourne <code>false</code> s’il n’y a pas de prochaine ligne.</li>
</ul>
</dd>
</dl>
<div class="box">
<p><em>L’intérêt de la méthode <code>fetch</code> se trouve dans les <strong>paramètres</strong> qu’on peut lui spécifier <span class="math inline">\(\rightarrow\)</span> <a href="https://www.php.net/manual/fr/pdostatement.fetch.php">voir documentation</a>.</em></p>
</div>
</section>
<section id="le-parcours-en-action" class="slide level2">
<h2>Le parcours en action</h2>
<p class="r-stack">
<img data-src="img/queryFetch01.png" class="fragment" /> <img data-src="img/queryFetch02.png" class="fragment" /> <img data-src="img/queryFetch03.png" class="fragment" /> <img data-src="img/queryFetch04.png" class="fragment" /> <img data-src="img/queryFetch05.png" class="fragment" /> <img data-src="img/queryFetch06.png" class="fragment" /> <img data-src="img/queryFetch07.png" class="fragment" /> <img data-src="img/queryFetch08.png" class="fragment" /> <img data-src="img/queryFetch09.png" class="fragment" /> <img data-src="img/queryFetch10.png" class="fragment" /> <img data-src="img/queryFetch11.png" class="fragment" /> <img data-src="img/queryFetch12.png" class="fragment" /> <img data-src="img/queryFetch13.png" class="fragment" /> <img data-src="img/queryFetch14.png" class="fragment" /> <img data-src="img/queryFetch15.png" class="fragment" /> <img data-src="img/queryFetch16.png" class="fragment" /> <img data-src="img/queryFetch17.png" class="fragment" /> <img data-src="img/queryFetch18.png" class="fragment" /> <img data-src="img/queryFetch19.png" class="fragment" /> <img data-src="img/queryFetch20.png" class="fragment" />
</p>
</section>
<section id="requêtes-préparées" class="slide level2">
<h2>Requêtes préparées</h2>
<dl>
<dt><a href="https://www.php.net/manual/en/pdo.prepare.php"><code>PDO::prepare( string $statement ) : PDOStatement</code></a></dt>
<dd><ul>
<li><strong>Prépare</strong> une requête mais ne l’exécute pas.</li>
<li>Se paramétre avec des <strong>marqueurs</strong></li>
<li>Retourne un objet de type <code>PDOStatement</code>.</li>
</ul>
</dd>
</dl>
<pre class="php contenteditable centerh"><code>$request = $pdo-&gt;prepare( &quot;SELECT * FROM Students WHERE age &gt; :value&quot; );</code></pre>
<dl>
<dt><a href="https://www.php.net/manual/fr/pdostatement.bindvalue.php"><code>PDOStatement::bindValue( mixed $param, mixed $val [, int $type ] ) : bool</code></a></dt>
<dd><ul>
<li>Associe la valeur <code>$val</code> au marqueur <code>$param</code></li>
</ul>
</dd>
</dl>
<pre class="php contenteditable centerh"><code>$request-&gt;bindvalue( &#39;:value&#39;, 20, PDO::PARAM_INT );</code></pre>
<dl>
<dt><a href="https://www.php.net/manual/fr/pdostatement.execute.php"><code>PDOStatement::execute() : bool</code></a></dt>
<dd><ul>
<li>Exécute la requête préparée</li>
</ul>
</dd>
</dl>
<pre class="php contenteditable centerh"><code>$request-&gt;execute();</code></pre>
</section>
<section id="marqueurs-indexés-vs.-nommés" class="slide level2">
<h2>Marqueurs indexés vs. nommés</h2>
<div class="columns centerh">
<div>
<pre class="php contenteditable centerh"><code>// 1.a Prépare la requête
$request = $pdo-&gt;prepare(
    &quot;SELECT name FROM Students
     WHERE note &lt; ? AND note &gt; ?&quot;
);
// 2.a Assigne 10 au 1er paramètre
$ok1 = $request-&gt;bindValue(
    1, 10, PDO::PARAM_INT
);
// 3.a Assigne 10 au 2ème paramètre
$ok1 &amp;= $request-&gt;bindValue(
    2, 20, PDO::PARAM_INT
);</code></pre>
<p>Marqueurs <strong>indexés</strong> : <code>?</code></p>
</div><div>
<pre class="php contenteditable centerh"><code>// 1.b Prépare la requête
$request = $pdo-&gt;prepare(
    &quot;SELECT name FROM Students
     WHERE note &lt; :min AND note &gt; :max&quot;
);
// 2.b Assigne 10 au paramètre :min
$ok1 = $request-&gt;bindValue(
    &#39;:min&#39;, 10, PDO::PARAM_INT
);
// 3.b Assigne 10 au paramètre :max
$ok1 &amp;= $request-&gt;bindValue(
    &#39;:max&#39;, 20, PDO::PARAM_INT
);</code></pre>
<p>Marqueurs <strong>nommés</strong> : <code>:name</code></p>
</div>
</div>
<pre class="php contenteditable centerh"><code>// 4. On exécute la requête $request
$ok2 = $request-&gt;execute();

// 5. On parcourt et affiche les données trouvées dans la base
foreach ( $request as $row ) {
    echo &quot;M. &quot; . $row[&#39;name&#39;] . &#39; a une note &lt; 10&#39;;
}</code></pre>
<p class="centerh">
Parcours des données identique.
</p>
</section>
<section id="requêtes-simples-vs.-préparées" class="slide level2">
<h2>Requêtes simples vs. préparées</h2>
<div class="images centerh width-50">
<p><img data-src="img/injectionSql.jpg" /></p>
</div>
<dl>
<dt>Les requêtes préparées</dt>
<dd><ul>
<li><strong>protègent</strong> des injections SQL grâce aux marqueurs</li>
<li>sont <strong>réutilisables</strong></li>
<li>permettent d’utiliser <strong>moins de resources</strong></li>
<li>s’exécutent <strong>plus rapidement</strong></li>
<li>affranchissent de la préoccupation des guillemets</li>
</ul>
</dd>
</dl>
<div class="centerh width-90">
<blockquote>
<p>Illustration des injections SQL au prochain TD.</p>
</blockquote>
</div>
</section>
<section id="conception-mvc" class="slide level2 chapter">
<h2>Conception MVC</h2>
</section>
<section id="maîtrisez-vous-a31" class="slide level2">
<h2>Maîtrisez-vous A31 ?</h2>
<p class="r-stack">
<img data-src="img/mvc01.png" class="fragment" /> <img data-src="img/mvc02.png" class="fragment" /> <img data-src="img/mvc03.png" class="fragment" /> <img data-src="img/mvc04.png" class="fragment" /> <img data-src="img/mvc05.png" class="fragment" /> <img data-src="img/mvc06.png" class="fragment" /> <img data-src="img/mvc07.png" class="fragment" /> <img data-src="img/mvc08.png" class="fragment" /> <img data-src="img/mvc09.png" class="fragment" /> <img data-src="img/mvc10.png" class="fragment" /> <img data-src="img/mvc11.png" class="fragment" />
</p>
</section>
<section id="principe" class="slide level2">
<h2>Principe</h2>
<div class="images centerh width-70">
<p><img data-src="img/mvc11.png" /></p>
</div>
<p><strong>MVC</strong> <em>(Modèle-Vue-Contrôleur)</em> est une architecture logicielle qui propose un découpage en trois entités :</p>
<ul>
<li>les <strong>Modèles</strong> qui contiennent les données,</li>
<li>les <strong>Vues</strong> qui définissent l’affichage du modèle,</li>
<li>les <strong>Contrôleurs</strong> qui contiennent la logique de l’application et répondent aux requêtes en coordonnant les modèles et les vues.</li>
</ul>
</section>
<section id="en-pratique" class="slide level2">
<h2>En pratique</h2>
<p>Vous avez mis en place sans le savoir une architecture MVC avec l’authentification du TP2.</p>
<p class="r-stack">
<img data-src="img/mvcFiles1.png" class="fragment" /> <img data-src="img/mvcFiles2.png" class="fragment" /> <img data-src="img/mvcFiles3.png" class="fragment" /> <img data-src="img/mvcFiles4.png" class="fragment" />
</p>
</section>
<section id="en-pratique-1" class="slide level2">
<h2>En pratique</h2>
<div class="images centerh width-70">
<p><img data-src="img/mvcFiles4.png" /></p>
</div>
<div class="r-stack">
<div class="fragment fade-out">
<dl>
<dt><strong>Contrôleurs</strong></dt>
<dd><ul>
<li><code>authenticate.php</code> <strong>manipule</strong> <code>users.php</code> pour vérifier si l’utilisateur à le droit de se connecter et suivant le cas, <strong>sélectionne</strong> <code>welcome.php</code> ou <code>signin.php</code>.</li>
<li><code>signout.php</code> déconnecte l’utilisateur et <strong>sélectionne</strong> <code>signin.php</code>.</li>
</ul>
</dd>
</dl>
</div>
<div class="fragment fade-in">
<div class="fragment fade-out">
<dl>
<dt><strong>Modèle</strong></dt>
<dd><ul>
<li><code>users.php</code> est un modèle sous forme de tableau.</li>
<li>Il est <strong>manipulé</strong> par <code>authenticate.php</code> pour <strong>mettre à jour</strong> <code>welcome.php</code> lorsque l’utilisateur se connecte.</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="fragment fade-in">
<dl>
<dt><strong>Vues</strong></dt>
<dd><ul>
<li><code>signin.php</code> <strong>affiche</strong> le formulaire d’authentification.</li>
<li><code>welcome.php</code> <strong>affiche</strong> la page d’accueil personnalisée.</li>
</ul>
</dd>
</dl>
</div>
</div>
</section>
<section id="bonus-héritage" class="slide level2 chapter">
<h2>Bonus : Héritage</h2>
</section>
<section id="les-interfaces" class="slide level2">
<h2>Les interfaces</h2>
<div class="columns centerh">
<pre class="php contenteditable centerh"><code>interface Module
{
    function getName() : string;
    function setProf( string $nom ) : void;
}</code></pre><pre class="php contenteditable centerh"><code>class W31 implements Module
{
    public $_prof;
    function getName() : string {
        return &quot;W31&quot;;
    }
    function setProf( string $nom ) : void {
        $this-&gt;prof = $nom;
    }
}</code></pre>
</div>
<dl>
<dt>Définition</dt>
<dd>Une interface <strong>spécifie la signature des méthodes</strong> que doit définir une classe qui l’implémente.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>Une interface :</dt>
<dd><ul>
<li>ne spécifie que des fonctions publiques</li>
<li>ne peut pas contenir d’attribut</li>
<li>ne peut pas définir l’implémentation d’une méthode</li>
</ul>
</dd>
</dl>
</div>
</section>
<section id="intérêt-des-interfaces" class="slide level2">
<h2>Intérêt des interfaces</h2>
<div class="columns">
<pre class="php contenteditable"><code>interface Module
{
    function name() : string;
    function prof() : string;
}
function printModule( Module $mod )
{
    echo $mod-&gt;name().&#39; : &#39;.$mod-&gt;prof();
}</code></pre><pre class="php contenteditable"><code>class W31 implements Module {
    function name() : string { return &quot;W31&quot;; }
    function prof() : string { return &quot;KRA&quot;; }
}

class M31 implements Module {
    function name() : string { return &quot;M31&quot;; }
    function prof() : string { return &quot;HAJ&quot;; }
}</code></pre>
</div>
<p>Définir une fonction qui manipule <strong>un objet implémentant une interface donnée</strong> garantit qu’il possède les méthodes de l’interface.<br />
<br />
</p>
<div class="columns fragment">
<pre class="php contenteditable"><code>$mod1 = new W31();
printModule($mod1);
// Affiche &quot;W31 : Kra&quot;</code></pre><pre class="php contenteditable"><code>$mod2 = new M31();
printModule($mod2);
// Affiche &quot;M31 : HAJ&quot;</code></pre>
</div>
<p><br></p>
<div class="centerh fragment">
<p><span class="math inline">\(\rightarrow\)</span> la fonction est donc… <span class="fragment"> <strong>générique</strong> par <strong>polymorphisme</strong> ! </span></p>
</div>
</section>
<section id="les-classes-abstraites" class="slide level2">
<h2>Les classes abstraites</h2>
<div class="columns centerh">
<pre class="php contenteditable centerh"><code>abstract class Module
{
    private $_name;

    function __construct( string $name ) {
        $this-&gt;_name = $name;
    }
    function print() : void {
        echo $this-&gt;_name.&#39; : &#39;.$this-&gt;prof();
    }
    abstract function prof() : string;
}</code></pre><div>
<pre class="php contenteditable centerh"><code>class W31 extends Module
{
    function __construct() {
        parent::__construct(&quot;W31&quot;);
    }
    function prof() : string {
        return &quot;Adrien&quot;;
    }
}</code></pre>
<pre class="php contenteditable centerh"><code>$obj = new W31();
$obj-&gt;print(); // Affiche &quot;W31 : Adrien&quot;</code></pre>
</div>
</div>
<dl>
<dt>Définition</dt>
<dd>Une classe abstraite est à mi-chemin entre interface et classe concrète. Elle <strong>peut</strong> comporter des méthodes abstraites <strong>ET</strong> concrètes.
</dd>
</dl>
<div class="fragment">
<dl>
<dt>Une classe abstraite :</dt>
<dd><ul>
<li>ne peut pas être instanciée</li>
<li>peut contenir des attributs</li>
</ul>
</dd>
</dl>
</div>
</section>
<section id="intérêt-des-classes-abstraites" class="slide level2">
<h2>Intérêt des classes abstraites</h2>
<div class="columns centerh">
<pre class="php contenteditable centerh"><code>abstract class MaClasseAbstraite
{
    private   $_attribut1;
    protected $_attribut2;

    abstract public function methode1();
    abstract public function methode2();
    public function methode3() { ... }
    public function methode4() { ... }
}</code></pre><div>
<pre class="php contenteditable centerh"><code>class MaClasse extends MaClasseAbstraite
{
    public function methode1() { ... }
    public function methode2() { ... }
    public function methode4() { ... }
}</code></pre>
<pre class="php contenteditable centerh"><code>$obj = new MaClasse();
$obj-&gt;methode2(); // OK
$obj-&gt;methode3(); // OK
$obj-&gt;methode4(); // OK</code></pre>
</div>
</div>
<p>Comme les interfaces, elles permettent d’écrire du code <strong>générique</strong>. De plus, elles permettent de <strong>mutualiser</strong> du code.</p>
<p>Une classe qui hérite d’une classe abstraite :</p>
<ul>
<li>doit définir <strong>toutes</strong> les méthodes <code>abstract</code> de la classe mère</li>
<li><strong>peut surcharger</strong> une méthode concrète</li>
</ul>
</section>

 <!--                         </End Markdown>
 ===========================================================================-->

</div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script src="plugin/math/math.js"></script>
<script src="plugin/reveal.js-menu/menu.js"></script>

<script type="text/javascript">;
Reveal.initialize({
// Display presentation control arrows
controls: true,

// Help the user learn the controls by providing hints, for example by
// bouncing the down arrow when they first encounter a vertical slide
controlsTutorial: false,

// Determines where controls appear, "edges" or "bottom-right"
controlsLayout: 'edges',

// Visibility rule for backwards navigation arrows; "faded", "hidden"
// or "visible"
controlsBackArrows: 'faded',

// Display a presentation progress bar
progress: true,

// Display the page number of the current slide
// h.v|h/v|c|c/t
slideNumber: "c/t",

// Can be used to limit the contexts in which the slide number appears
// - "all":      Always show the slide number
// - "print":    Only when printing to PDF
// - "speaker":  Only in the speaker view
showSlideNumber: 'all',

// Use 1 based indexing for # links to match slide number (default is zero
// based)
hashOneBasedIndex: true,

// Add the current slide number to the URL hash so that reloading the
// page/copying the URL will return you to the same slide
hash: true,

// Flags if we should monitor the hash and change slides accordingly
respondToHashChanges: true,

// Push each slide change to the browser history
history: false,

// Enable keyboard shortcuts for navigation
keyboard: true,

// Optional function that blocks keyboard events when retuning false
//
// If you set this to 'foucsed', we will only capture keyboard events
// for embdedded decks when they are in focus
keyboardCondition: null,

// Disables the default reveal.js slide layout (scaling and centering)
// so that you can use custom CSS layout
disableLayout: false,

// Enable the slide overview mode
overview: true,

// Vertical centering of slides
center: false,

// Enables touch navigation on devices with touch input
touch: true,

// Loop the presentation
loop: true,

// Change the presentation direction to be RTL
rtl: false,

// Changes the behavior of our navigation directions.
//
// "default"
// Left/right arrow keys step between horizontal slides, up/down
// arrow keys step between vertical slides. Space key steps through
// all slides (both horizontal and vertical).
//
// "linear"
// Removes the up/down arrows. Left/right arrows step through all
// slides (both horizontal and vertical).
//
// "grid"
// When this is enabled, stepping left/right from a vertical stack
// to an adjacent vertical stack will land you at the same vertical
// index.
//
// Consider a deck with six slides ordered in two vertical stacks:
// 1.1    2.1
// 1.2    2.2
// 1.3    2.3
//
// If you're on slide 1.3 and navigate right, you will normally move
// from 1.3 -> 2.1. If "grid" is used, the same navigation takes you
// from 1.3 -> 2.3.
navigationMode: 'linear',

// Randomizes the order of slides each time the presentation loads
shuffle: false,

// Turns fragments on and off globally
fragments: true,

// Flags whether to include the current fragment in the URL,
// so that reloading brings you to the same fragment position
fragmentInURL: false,

// Flags if the presentation is running in an embedded mode,
// i.e. contained within a limited portion of the screen
embedded: false,

// Flags if we should show a help overlay when the questionmark
// key is pressed
help: true,

// Flags if it should be possible to pause the presentation (blackout)
pause: true,

// Flags if speaker notes should be visible to all viewers
showNotes: false,

// Global override for autoplaying embedded media (video/audio/iframe)
// - null: Media will only autoplay if data-autoplay is present
// - true: All media will autoplay, regardless of individual setting
// - false: No media will autoplay, regardless of individual setting
autoPlayMedia: null,

// Global override for preloading lazy-loaded iframes
// - null:   Iframes with data-src AND data-preload will be loaded when within
//           the viewDistance, iframes with only data-src will be loaded when visible
// - true:   All iframes with data-src will be loaded when within the viewDistance
// - false:  All iframes with data-src will be loaded only when visible
preloadIframes: null,

// Can be used to globally disable auto-animation
autoAnimate: true,

// Optionally provide a custom element matcher that will be
// used to dictate which elements we can animate between.
autoAnimateMatcher: null,

// Default settings for our auto-animate transitions, can be
// overridden per-slide or per-element via data arguments
autoAnimateEasing: 'ease',
autoAnimateDuration: 1.0,
autoAnimateUnmatched: true,

// CSS properties that can be auto-animated. Position & scale
// is matched separately so there's no need to include styles
// like top/right/bottom/left, width/height or margin.
autoAnimateStyles: [
'opacity',
'color',
'background-color',
'padding',
'font-size',
'line-height',
'letter-spacing',
'border-width',
'border-color',
'border-radius',
'outline',
'outline-offset'
],

// Number of milliseconds between automatically proceeding to the
// next slide, disabled when set to 0, this value can be overwritten
// by using a data-autoslide attribute on your slides
autoSlide: 0,

// Stop auto-sliding after user input
autoSlideStoppable: true,

// Use this method for navigation when auto-sliding
autoSlideMethod: Reveal.navigateNext,

// Specify the average time in seconds that you think you will spend
// presenting each slide. This is used to show a pacing timer in the
// speaker view
defaultTiming: 120,

// Enable slide navigation via mouse wheel
mouseWheel: false,

// Opens links in an iframe preview overlay
// Add `data-preview-link` and `data-preview-link="false"` to customise each
// link individually
previewLinks: false,

// Exposes the reveal.js API through window.postMessage
postMessage: true,

// Dispatches all reveal.js events to the parent window through postMessage
postMessageEvents: true,

// Focuses body when page changes visibility to ensure keyboard shortcuts work
focusBodyOnPageVisibilityChange: true,

// Transition style
//     none/default/fade/slide/convex/concave/zoom/cube/page/linear
transition: 'slide',

// Transition speed
//     default/fast/slow
transitionSpeed: 'fast',

// Transition style for full page slide backgrounds
//    none/fade/slide/convex/concave/zoom
backgroundTransition: 'fade',

// The maximum number of pages a single slide can expand onto when printing
// to PDF, unlimited by default
pdfMaxPagesPerSlide: Number.POSITIVE_INFINITY,

// Prints each fragment on a separate slide
pdfSeparateFragments: false,

// Offset used to reduce the height of content within exported PDF pages.
// This exists to account for environment differences based on how you
// print to PDF. CLI printing options, like phantomjs and wkpdf, can end
// on precisely the total height of the document whereas in-browser
// printing has to end one pixel before.
pdfPageHeightOffset: -1,

// Number of slides away from the current that are visible
viewDistance: 3,

// Number of slides away from the current that are visible on mobile
// devices. It is advisable to set this to a lower number than
// viewDistance in order to save resources.
mobileViewDistance: 2,

// The display mode that will be used to show slides
display: 'flex',

// Hide cursor if inactive
hideInactiveCursor: true,

// Time before the cursor is hidden (in ms)
hideCursorTime: 5000,

math: {
    mathjax: 'plugin/math/MathJax.js',
    tex2jax: {
        inlineMath: [['\\(','\\)']] // Disable "dollard...dollard" as delimiter
    }
},

menu: {
		// Side of the the menu
        // left|right
		side: 'left',
		// Specifies the width of the menu.
		// normal|wide|third|half|full|any valid css length value
		width: 'half',
		// Slide numbers to the titles in the slide list.
		// false|true|h.v|h/v|c|c/t
		numbers: "h",
		// Slide elements used for generating the slide titles
		titleSelector: 'h1, h2',
		// If slides do not have a matching title, attempt to use the
		// start of the text content as the title instead
		useTextContentForMissingTitles: false,
		// Hide slides from the menu that do not have a title.
		hideMissingTitles: false,
		// Adds markers to the slide titles to indicate the
		// progress through the presentation.
		markers: true,
		// Specify custom panels to be included in the menu, by
		// providing an array of objects with 'title', 'icon'
		// properties, and either a 'src' or 'content' property.
		custom: false,
		// Specifies the themes that will be available in the themes
		// menu panel. Set to 'true' to show the themes menu panel
		// with the default themes list. Alternatively, provide an
		// array to specify the themes to make available in the
		// themes menu panel, for example...
		// [
		//     { name: 'Black', theme: 'css/theme/black.css' },
		//     { name: 'White', theme: 'css/theme/white.css' },
		//     { name: 'League', theme: 'css/theme/league.css' }
		// ]
		themes: false,
		// Specifies the path to the default theme files.
		themesPath: 'css/theme/',
		// Specifies if the transitions menu panel will be shown.
		transitions: false,
		// Adds a menu button to the slides to open the menu panel.
		openButton: true,
		// Allows the slide number to open the menu panel
		openSlideNumber: false,
		// Allows the user to open and navigate the menu using the keyboard.
		keyboard: true,
		// Leave the menu open until it is explicitly closed
		sticky: false,
		// If 'true' the menu will not be created until it is explicitly
		// requested by calling RevealMenu.init().
		delayInit: false,
		// If 'true' the menu will be shown when the menu is initialised.
		openOnInit: false,
		// By default the menu will load it's own font-awesome library
		// icons. If your presentation needs to load a different
		// font-awesome library the 'loadIcons' option can be set to false
		// and the menu will not attempt to load the font-awesome library.
		loadIcons: true
	},
    /* multiplex: {
        // Example values. To generate your own, see the socket.io server instructions.
        secret: '15990667632399177968', // null so the clients do not have control of the master presentation
        id: '792d8d97a4db6875', // id, obtained from socket.io server
        url: '127.0.0.1:1948' // Location of your socket.io server
    },
    // Don't forget to add the dependencies
    dependencies: [
        { src: 'http://127.0.0.1:1948/socket.io/socket.io.js', async: true },
        { src: (new URLSearchParams(window.location.search)).get('s') == 'akrah' ? 'http://127.0.0.1:1948/master.js' : 'http://127.0.0.1:1948/client.js', async: true },
    ], */
    plugins: [ RevealHighlight, RevealMath, RevealMenu ]
});

Reveal.on( 'ready', event => {
    // Add "contenteditable" attribute to all tags with the "contenteditable" CSS class.
    document.querySelectorAll('.contenteditable').forEach( el => el.setAttribute("contenteditable","true"));
});

</script>

</body>
</html>
